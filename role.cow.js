var util=require("util");RoomPosition.prototype.ordinals=function(){var a=this.x,b=this.y,c=this.roomName,a=[new RoomPosition(a+1,b+1,c),new RoomPosition(a+0,b+1,c),new RoomPosition(a-1,b+1,c),new RoomPosition(a+1,b+0,c),new RoomPosition(a-1,b+0,c),new RoomPosition(a+1,b-1,c),new RoomPosition(a+0,b-1,c),new RoomPosition(a-1,b-1,c)];return _.compact(a)};
RoomPosition.prototype.cardinals=function(){var a=this.x,b=this.y,c=this.roomName,a=[new RoomPosition(a+1,b+0,c),new RoomPosition(a-1,b+0,c),new RoomPosition(a+0,b+1,c),new RoomPosition(a+0,b-1,c)];return _.compact(a)};
RoomPosition.prototype.step=function(a){var b=this.x,c=this.y,d=this.roomName;switch(a){case TOP:c-=1;break;case TOP_RIGHT:b+=1;c-=1;break;case RIGHT:b+=1;break;case BOTTOM_RIGHT:b+=1;c+=1;break;case BOTTOM:c+=1;break;case BOTTOM_LEFT:b-=1;c+=1;break;case LEFT:b-=1;break;case TOP_LEFT:b-=1,c-=1}return new RoomPosition(b,c,d)};RoomPosition.prototype.is_terrain=function(a){var b=this.look(),c;for(c in b){var d=b[c];if("terrain"==d.type&&d.terrain==a)return!0}return!1};
RoomPosition.prototype.is_swamp=function(){return this.is_terrain("swamp")};RoomPosition.prototype.is_wall=function(){return this.is_terrain("wall")};RoomPosition.prototype.is_plain=function(){return is_terrain("plain")};RoomPosition.prototype.non_wall_adjacent=function(){return _.reject(this.ordinals(),function(a){return a.is_wall()})};function memoryPosition(a){return a?new RoomPosition(a.x,a.y,a.roomName):null}
var roleCow={run:function(a){var b=Game.getObjectById(a.memory.source_id);if(!b){var b=a.room.find(FIND_SOURCES),c={};b.forEach(function(a){c[a]=0});a.room.find(FIND_MY_CREEPS).forEach(function(b){a==b||"cow"!=b.memory.role||(b=Game.getObjectById(a.memory.source_id),console.log("found cow"+a+" using source"+b),c[b]++,console.log(JSON.stringify(c)))});b=_.sortBy(b,function(a){return c[a]});if(b=b[0])a.memory.source_id=b.id}var d=memoryPosition(a.memory.pasture_loc);d||(d=_.sample(b.pos.non_wall_adjacent()),
a.memory.pasture_loc=d);if(d.is_wall()||1!=d.getRangeTo(b))a.say("!ploc"),a.memory.debug_bad_pasture_loc=d,a.memory.pasture_loc=null;else if(d.isEqualTo(a.pos)){d=Game.getObjectById(a.memory.output_container_id);if(!d){var e=a.pos.findInRange(FIND_STRUCTURES,1,{filter:function(a){return a.structureType==STRUCTURE_CONTAINER}});e.length&&(d=e[0],a.memory.output_container_id=d.id)}d?d&&(d.structureType!=STRUCTURE_CONTAINER||1!=d.pos.getRangeTo(a))?(a.say("umm"),a.memory.output_container_id=null):(a.harvest(b),
d.hits<d.hitsMax/2?a.repair(d):a.transfer(d,RESOURCE_ENERGY)):(d=a.pos.findInRange(FIND_CONSTRUCTION_SITES,1,filter=function(a){return a.structureType==STRUCTURE_CONTAINER}),d.length?(b=d[0],a.add_task({type:"construct",target_id:b.id,resupply:"harvest"})):(b=b.pos.getDirectionTo(a),a.pos.step(b).createConstructionSite(STRUCTURE_CONTAINER)))}else a.moveTo(d)}};module.exports=roleCow;
