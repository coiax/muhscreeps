var util=require("util");RoomPosition.prototype.ordinals=function(){var b=this.x,c=this.y,a=this.roomName,b=[new RoomPosition(b+1,c+1,a),new RoomPosition(b+0,c+1,a),new RoomPosition(b-1,c+1,a),new RoomPosition(b+1,c+0,a),new RoomPosition(b-1,c+0,a),new RoomPosition(b+1,c-1,a),new RoomPosition(b+0,c-1,a),new RoomPosition(b-1,c-1,a)];return _.compact(b)};
RoomPosition.prototype.cardinals=function(){var b=this.x,c=this.y,a=this.roomName,b=[new RoomPosition(b+1,c+0,a),new RoomPosition(b-1,c+0,a),new RoomPosition(b+0,c+1,a),new RoomPosition(b+0,c-1,a)];return _.compact(b)};
RoomPosition.prototype.step=function(b){var c=this.x,a=this.y,d=this.roomName;switch(b){case TOP:a-=1;break;case TOP_RIGHT:c+=1;a-=1;break;case RIGHT:c+=1;break;case BOTTOM_RIGHT:c+=1;a+=1;break;case BOTTOM:a+=1;break;case BOTTOM_LEFT:c-=1;a+=1;break;case LEFT:c-=1;break;case TOP_LEFT:c-=1,a-=1}return new RoomPosition(c,a,d)};RoomPosition.prototype.is_terrain=function(b){var c=this.look(),a;for(a in c){var d=c[a];if("terrain"==d.type&&d.terrain==b)return!0}return!1};
RoomPosition.prototype.is_swamp=function(){return this.is_terrain("swamp")};RoomPosition.prototype.is_wall=function(){return this.is_terrain("wall")};RoomPosition.prototype.is_plain=function(){return is_terrain("plain")};RoomPosition.prototype.non_wall_adjacent=function(){return _.reject(this.ordinals(),function(b){return b.is_wall()})};function memoryPosition(b){return b?new RoomPosition(b.x,b.y,b.roomName):null}
var roleCow={run:function(b){var c=Game.getObjectById(b.memory.source_id);if(!c&&(c=b.room.find(FIND_SOURCES),c=_.sample(c)))b.memory.source_id=c.id;var a=memoryPosition(b.memory.pasture_loc);a||(a=_.sample(c.pos.non_wall_adjacent()),b.memory.pasture_loc=a);if(a.is_wall()||1!=a.getRangeTo(c))b.say("!ploc"),b.memory.debug_bad_pasture_loc=a,b.memory.pasture_loc=null;else if(a.isEqualTo(b.pos)){a=Game.getObjectById(b.memory.output_container_id);if(!a){var d=b.pos.findInRange(FIND_STRUCTURES,1,filter=
function(a){return a.structureType==STRUCTURE_CONTAINER});d.length&&(a=d[0],b.memory.output_container_id=a.id)}a?a&&a.structureType!=STRUCTURE_CONTAINER?(b.say("umm"),b.memory.output_container_id=null):(b.harvest(c),a.hits<a.hitsMax&&b.repair(a),b.transfer(a,RESOURCE_ENERGY)):(a=b.pos.findInRange(FIND_CONSTRUCTION_SITES,1,filter=function(a){return a.structureType==STRUCTURE_CONTAINER}),a.length?(c=a[0],b.add_task({type:"construct",target:c.id,resupply:!0})):(c=c.getDirectionTo(b),b.pos.step(c).createConstructionSite(STRUCTURE_CONTAINER)))}else b.moveTo(a)}};
module.exports=roleCow;
