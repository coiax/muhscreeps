var task_manager=require("task_manager");function sort_construction_sites(b){return _.orderBy(b,function(a){return a.progressTotal-a.progress},"desc")}function sort_structures(b){return _.sortBy(b,function(a){return a.hits})}
var roleBuilder={name:"role.builder",run:function(b,a){if(0==a.carry.energy)return b={type:"resupply"},{outcome:"newtask",task:b};var c=Game.flags.Dismantle;if(c){if(!c.room)return a.moveTo(c),{outcome:"continue"};var d=c.pos.findInRange(FIND_STRUCTURES,0);if(d&&d.length)return b={type:"dismantle",target_id:d[0].id},{outcome:"newtask",task:b};c.remove()}var c=a.pos.findClosestByRange(FIND_CONSTRUCTION_SITES),d=sort_structures(a.room.find(FIND_MY_STRUCTURES,{filter:function(a){return a.structureType!=
STRUCTURE_RAMPART&&a.hits<a.hitsMax}})),f=sort_structures(a.room.find(FIND_STRUCTURES,{filter:function(a){return a.hits<a.hitsMax}})),e;c?e=c:d.length?e=d[0]:f.length&&(e=f[0]);if(e)return b={type:"construct",target_id:e.id},{outcome:"newtask",task:b};a.say("no work");return{outcome:"continue"}}};module.exports=roleBuilder;task_manager.register(roleBuilder.name,roleBuilder.run);
