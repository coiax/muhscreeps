function sort_construction_sites(a){return _.orderBy(a,function(a){return a.progressTotal-a.progress},"desc")}function sort_structures(a){return _.sortBy(a,function(a){return a.hits})}
var roleBuilder={run:function(a){if(0==a.carry.energy)a.add_task({type:"resupply"});else{var c=Game.flags.Dismantle;if(c){var b=c.pos.findClosestByRange(FIND_STRUCTURES);b&&a.add_task({type:"dismantle",target:b.id});c.remove()}else{var c=a.pos.findClosestByRange(FIND_CONSTRUCTION_SITES),d=sort_structures(a.room.find(FIND_MY_STRUCTURES,{filter:function(a){return a.hits<a.hitsMax}})),e=sort_structures(a.room.find(FIND_STRUCTURES,{filter:function(a){return a.hits<a.hitsMax}}));c?b=c:d.length?b=d[0]:
e.length&&(b=e[0]);b?a.add_task({type:"construct",target_id:b.id}):a.say("no work")}}}};module.exports=roleBuilder;
