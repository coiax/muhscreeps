function sort_construction_sites(a){return _.sortBy(a,function(a){return a.progress-a.progressTotal})}function sort_structures(a){return _.sortBy(a,function(a){return a.hits-a.hitsMax})}
var roleBuilder={run:function(a){if(0==a.carry.energy)a.add_task({type:"harvest"});else{var c=a.pos.findClosestByPath(FIND_CONSTRUCTION_SITES),e=sort_structures(a.room.find(FIND_MY_STRUCTURES,{filter:function(a){return a.hits<a.hitsMax}})),f=sort_structures(a.room.find(FIND_STRUCTURES,{filter:function(a){return a.hits<a.hitsMax}})),d=Game.flags.Priority,b;d&&d.pos.roomName==a.pos.roomName?(c=d.pos.lookFor(FIND_CONSTRUCTION_SITES),c.length?b=c[0]:d.remove()):c?b=c:e.length?b=e[0]:f.length&&(b=f[0]);
b?a.add_task({type:"construct",target:b.id}):a.say("no work")}}};module.exports=roleBuilder;
