var util=require("util"),task_manager=require("task_manager");
module.exports={name:"structure.tower",run:function(f,b){var a,c;a||(a=b.pos.findClosestByRange(FIND_HOSTILE_CREEPS),c="attack");a||(a=b.pos.findDamagedFriendlyCreeps(),a=b.pos.findClosestByRange(a),c="heal");a||(a=b.pos.findClosestByRange(FIND_MY_STRUCTURES,{filter:function(a){return a.structureType!=STRUCTURE_RAMPART&&a.hits<a.hitsMax}}),c="repair");if(!a){var e=[STRUCTURE_CONTAINER,STRUCTURE_ROAD];0==Game.time%10&&e.push([STRUCTURE_WALL,STRUCTURE_RAMPART]);for(var g in e){var d=b.pos.findDamagedStructures(e[g]),
d=_.sortBy(d,_.property("hits"));if(d.length){a=d[0];c="repair";break}}}return a?(f={type:"tower_target",target_id:a.id,mode:c},{outcome:"newtask",task:f}):{outcome:"continue"}}};task_manager.register(module.exports.name,module.exports.run);
