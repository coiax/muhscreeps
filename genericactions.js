Creep.prototype.add_task=function(b){this.memory.task_queue||(this.memory.task_queue=[]);this.memory.task_queue.unshift(b)};Creep.prototype.pop_task=function(){this.memory.task_queue=_.drop(this.memory.task_queue);0==this.memory.task_queue.length&&(this.memory.task_queue=void 0)};Creep.prototype.renewCost=function(){return floor(600/this.body.length)};Structure.prototype.getMemory=function(){var b=Memory.structures[this.id];if(b)return b;Memory.structures[this.id]={};return Memory.structures[this.id]};
Structure.prototype.add_task=function(b){var a=this.getMemory();a.task_queue||(a.task_queue=[]);a.task_queue.unshift(b)};Structure.prototype.pop_task=function(){var b=this.getMemory();b.task_queue=_.drop(b.task_queue);0==b.task_queue.length&&(b.task_queue=void 0)};
module.exports={harvest:function(b,a){if(a.carryCapacity==a.carry.energy)return{outcome:"didnothing"};var c=Game.getObjectById(b.selected_source_id);if(!c&&(c=a.pos.findClosestByRange(FIND_SOURCES)))b.selected_source_id=c.id;return!c?(a.say("!sr?:("),{outcome:"newtask",task:{type:"resupply"}}):a.harvest(c)==ERR_NOT_IN_RANGE?(a.moveTo(c),{outcome:"continue"}):a.carryCapacity==a.carry.energy?{outcome:"done"}:{outcome:"continue"}},construct:function(b,a){var c=b.resupply,d=Game.getObjectById(b.target_id);
if(!d)return a.say("cs ?!?"),{outcome:"didnothing"};if(0==a.carry.energy)return c?{outcome:"newtask",task:{type:c}}:{outcome:"didnothing"};if("undefined"==typeof d.progress){if(d.hits==d.hitsMax)return{outcome:"didnothing"};c=a.repair(d)}else c=a.build(d);c==ERR_NOT_IN_RANGE&&a.moveTo(d);return{outcome:"continue"}},resupply:function(b,a){var c=a.carryCapacity-a.carry.energy;if(0==c)return{outcome:"didnothing"};var d=Game.getObjectById(b.gas_station_id);if(!d){var e=a.room.find(FIND_STRUCTURES,{filter:function(a){return a.structureType!=
STRUCTURE_CONTAINER?!1:a.store[RESOURCE_ENERGY]>c}});e.length&&(d=a.pos.findClosestByRange(e),b.gas_station_id=d.id)}if(!d)return{outcome:"replace",task:{type:"harvest"}};e=a.withdraw(d,RESOURCE_ENERGY);return e==ERR_NOT_IN_RANGE?(a.moveTo(d),{outcome:"continue"}):e!=OK?(a.say("rs"+e),{outcome:"continue"}):{outcome:"done"}},renew:function(b,a){if(1400<=a.ticksToLive)return{outcome:"done"};var c=Game.getObjectById(b.spawn_id);if(!c&&(c=a.pos.findClosestByRange(FIND_MY_SPAWNS)))b.spawn_id=c.id;if(!c)return a.say("SPN?!?"),
{outcome:"done"};var d=c.renewCreep(a);a.transfer(c,RESOURCE_ENERGY);if(d==ERR_NOT_IN_RANGE)a.moveTo(c);else if(d==ERR_FULL||d==ERR_NOT_ENOUGH_ENERGY)return{outcome:"done"};return{outcome:"continue"}},transfer_energy:function(b,a){target=Game.getObjectById(b.target_id);if(!target||target.energy==target.energyCapacity||0==a.carry.energy)return{outcome:"didnothing"};switch(a.transfer(target,RESOURCE_ENERGY)){case ERR_NOT_IN_RANGE:a.moveTo(target);break;case ERR_FULL:case ERR_INVALID_TARGET:return{outcome:"didnothing"};
case OK:return{outcome:"done"}}return{outcome:"continue"}},tower_target:function(b,a){target=Game.getObjectById(b.target_id);mode=b.mode;if(!mode||!target||b.times_run&&25<b.times_run)return{outcome:"didnothing"};var c;switch(mode){case "heal":if(target.hits==target.hitsMax)return{outcome:"didnothing"};c=heal(target);break;case "repair":if(target.hits==target.hitsMax)return{outcome:"didnothing"};c=repair(target);break;case "attack":c=attack(target)}switch(c){case ERR_INVALID_TARGET:case ERR_RCL_NOT_ENOUGH:return{outcome:"didnothing"};
case OK:case ERR_NOT_ENOUGH_RESOURCES:return{outcome:"continue"}}}};
