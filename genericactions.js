Creep.prototype.add_task=function(d){this.memory.task_queue||(this.memory.task_queue=[]);this.memory.task_queue.unshift(d)};Creep.prototype.pop_task=function(){this.memory.task_queue=_.drop(this.memory.task_queue);0==this.memory.task_queue.length&&(this.memory.task_queue=void 0)};
module.exports={harvest:function(d,a){if(a.carryCapacity==a.carry.energy)return{outcome:"done"};var b=Game.getObjectById(d.selected_source_id);b||(b=a.pos.findClosestByPath(FIND_SOURCES),d.selected_source_id=b.id);return a.harvest(b)==ERR_NOT_IN_RANGE?(a.moveTo(b),{outcome:"continue"}):a.carryCapacity==a.carry.energy?{outcome:"done"}:{outcome:"continue"}},construct:function(d,a){var b=d.resupply,c=Game.getObjectById(d.target_id);if(!c)return a.say("cs ?!?"),{outcome:"done"};if(0==a.carry.energy)return b?
{outcome:"newtask",task:{type:"harvest"}}:{outcome:"done"};if("undefined"==typeof c.progress){if(c.hits==c.hitsMax)return{outcome:"done"};b=a.repair(c)}else b=a.build(c);b==ERR_NOT_IN_RANGE&&a.moveTo(c);return{outcome:"continue"}},resupply:function(d,a){var b=a.carryCapacity-creeep.carry.energy;if(0==b)return{outcome:"done"};var c=Game.getObjectById(d.gas_station_id);c||(c=a.room.find(FIND_STRUCTURES,{filter:function(a){return a.structureType==STRUCTURE_CONTAINER}}),c=a.pos.findClosestByPath(c),d.gas_station_id=
c.id);if(!c||c.store[RESOURCE_ENERGY]<b)return{outcome:"replace",task:{type:"harvest"}};b=a.withdraw(c,RESOURCE_ENERGY);return b==ERR_NOT_IN_RANGE?(a.moveTo(target),{outcome:"continue"}):b!=OK?(a.say("rs"+b),{outcome:"continue"}):{outcome:"done"}}};
