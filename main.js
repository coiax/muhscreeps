var genericActions=require("genericactions"),roles=require("roles"),mother=require("mother"),util=require("util");
module.exports.loop=function(){mother.run();"undefined"==typeof Memory.structures&&(Memory.structures={});"undefined"==typeof Memory.cpu_use&&(Memory.cpu_use=[]);for(var d in Memory.structures)Game.structures[d]||delete Memory.structures[d];for(d in Game.structures){var e=Game.structures[d];if(e.isActive()){var a=e.getMemory(),f=e.structureType;a.type=f;(a=a.task_queue)&&util.run_task_queue(e,a);(!a||!a.length)&&f==STRUCTURE_TOWER&&roles.tower.run(e)}}for(var c in Game.creeps){var b=Game.creeps[c];
b.spawning||(b.room.find(FIND_DROPPED_ENERGY).forEach(function(a){b.pickup(a)}),b.carry.energy&&!b.memory.no_driveby_repair&&(d=b.pos.findInRange(FIND_STRUCTURES,3,{filter:util.is_damaged}),b.repair(_.sample(d))),a=b.memory.task_queue,100>b.ticksToLive&&(b.memory.recharge&&(!a||a.length&&"renew"!=a[0].type))&&b.add_task({type:"renew"}),util.run_task_queue(b,a),(!a||!a.length)&&roles[b.memory.role].run(b))}Memory.cpu_use.push({time:Game.time,use:Game.cpu.getUsed()});c=0;for(var g in Memory.cpu_use)c+=
Memory.cpu_use[g].use;c/=Memory.cpu_use.length;Memory.avg_cpu=c;100<Memory.cpu_use.length&&Memory.cpu_use.splice(0,Memory.cpu_use.length-100)};
