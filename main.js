require("prototype.creep");require("prototype.structure");require("prototype.room");require("prototype.roomposition");var gc=require("gc"),cpu_tracker=require("cpu_tracker"),genericActions=require("genericactions"),roles=require("roles"),mother=require("mother"),util=require("util");
module.exports.loop=function(){gc.gc();mother.run();for(var c in Game.rooms)Game.rooms[c].scout_room();for(var d in Game.structures)if(c=Game.structures[d],c.isActive()){var a=c.getMemory(),e=c.structureType;a.type=e;(a=a.task_queue)&&genericActions.run_task_queue(c,a);(!a||!a.length)&&e==STRUCTURE_TOWER&&roles.tower.run(c)}for(var f in Game.creeps){var b=Game.creeps[f];b.spawning||(b.room.find(FIND_DROPPED_ENERGY).forEach(function(a){b.pickup(a)}),b.carry.energy&&!b.memory.no_driveby_repair&&(d=
b.pos.findInRange(FIND_STRUCTURES,3,{filter:util.is_damaged}),b.repair(_.sample(d))),a=b.memory.task_queue,100>b.ticksToLive&&(b.memory.recharge&&(!a||a.length&&"renew"!=a[0].type))&&b.add_task({type:"renew"}),genericActions.run_task_queue(b,a),(!a||!a.length)&&roles[b.memory.role].run(b))}cpu_tracker.record_main()};
