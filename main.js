var roleHarvester=require("role.harvester"),roleUpgrader=require("role.upgrader"),roleBuilder=require("role.builder"),mother=require("mother");
module.exports.loop=function(){mother.run();var a=Game.getObjectById("TOWER_ID");if(a){var b=a.pos.findClosestByRange(FIND_STRUCTURES,{filter:function(a){return a.hits<a.hitsMax}});b&&a.repair(b);(b=a.pos.findClosestByRange(FIND_HOSTILE_CREEPS))&&a.attack(b)}for(var c in Game.creeps)a=Game.creeps[c],"harvester"==a.memory.role&&roleHarvester.run(a),"upgrader"==a.memory.role&&roleUpgrader.run(a),"builder"==a.memory.role&&roleBuilder.run(a)};module.exports={run:function(){}};roleBuilder={run:function(a){a.memory.building&&0==a.carry.energy&&(a.memory.building=!1);!a.memory.building&&a.carry.energy==a.carryCapacity&&(a.memory.building=!0);if(a.memory.building){var b=a.room.find(FIND_CONSTRUCTION_SITES);b.length&&a.build(b[0])==ERR_NOT_IN_RANGE&&a.moveTo(b[0])}else b=a.room.find(FIND_SOURCES),a.harvest(b[0])==ERR_NOT_IN_RANGE&&a.moveTo(b[0])}};module.exports=roleBuilder;roleHarvester={run:function(a){if(a.carry.energy<a.carryCapacity){var b=a.room.find(FIND_SOURCES);a.harvest(b[0])==ERR_NOT_IN_RANGE&&a.moveTo(b[0])}else b=a.room.find(FIND_STRUCTURES,{filter:function(a){return(a.structureType==STRUCTURE_EXTENSION||a.structureType==STRUCTURE_SPAWN||a.structureType==STRUCTURE_TOWER)&&a.energy<a.energyCapacity}}),0<b.length&&a.transfer(b[0],RESOURCE_ENERGY)==ERR_NOT_IN_RANGE&&a.moveTo(b[0])}};module.exports=roleHarvester;roleUpgrader={run:function(a){a.memory.upgrading&&0==a.carry.energy&&(a.memory.upgrading=!1);!a.memory.upgrading&&a.carry.energy==a.carryCapacity&&(a.memory.upgrading=!0);if(a.memory.upgrading)a.upgradeController(a.room.controller)==ERR_NOT_IN_RANGE&&a.moveTo(a.room.controller);else{var b=a.room.find(FIND_SOURCES);a.harvest(b[0])==ERR_NOT_IN_RANGE&&a.moveTo(b[0])}}};module.exports=roleUpgrader;
