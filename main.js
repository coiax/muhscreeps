require("prototype.creep");require("prototype.structure");require("prototype.room");require("prototype.roomposition");var gc=require("gc"),maintaining_costs=require("maintaining_costs"),genericActions=require("genericactions"),roles=require("roles"),mother=require("mother"),util=require("util");
module.exports.loop=function(){gc.gc();mother.run();for(var c in Game.rooms)Game.rooms[c].scout_room();for(var e in Game.structures)if(c=Game.structures[e],c.isActive()){var a=c.getMemory(),f=c.structureType;a.type=f;(a=a.task_queue)&&genericActions.run_task_queue(c,a);(!a||!a.length)&&f==STRUCTURE_TOWER&&roles.tower.run(c)}for(var d in Game.creeps){var b=Game.creeps[d];b.spawning||(b.room.find(FIND_DROPPED_ENERGY).forEach(function(a){b.pickup(a)}),b.carry.energy&&!b.memory.no_driveby_repair&&(e=
b.pos.findInRange(FIND_STRUCTURES,3,{filter:util.is_damaged}),b.repair(_.sample(e))),a=b.memory.task_queue,100>b.ticksToLive&&(b.memory.recharge&&(!a||a.length&&"renew"!=a[0].type))&&b.add_task({type:"renew"}),genericActions.run_task_queue(b,a),(!a||!a.length)&&roles[b.memory.role].run(b))}Memory.cpu_use||(Memory.cpu_use=[]);Memory.cpu_use.push({time:Game.time,use:Game.cpu.getUsed()});d=0;for(var g in Memory.cpu_use)d+=Memory.cpu_use[g].use;d/=Memory.cpu_use.length;Memory.avg_cpu=d;100<Memory.cpu_use.length&&
Memory.cpu_use.splice(0,Memory.cpu_use.length-100)};
